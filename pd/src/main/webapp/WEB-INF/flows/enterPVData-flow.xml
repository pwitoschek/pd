<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:flow="http://www.springframework.org/schema/webflow-config"
	xsi:schemaLocation="http://www.springframework.org/schema/webflow
	http://www.springframework.org/schema/webflow/spring-webflow-2.4.xsd"
	start-state="startEnterPVData">
	
	<on-start>
		<evaluate expression="new de.app.pd.entities.pv.Tagesertrag()" result="flowScope.tagesertrag"/>
		<evaluate expression="new de.app.pd.entities.pv.Tagesverbrauch()" result="flowScope.tagesverbrauch"/>
	</on-start>

	<view-state id="startEnterPVData"
		view="/WEB-INF/flows/photovoltaik/startEnterPVData.jsp" model="flowScope.tagesertrag">
		<on-entry>
			<evaluate expression="tagesertrag.setInitValues()" result="flowScope.tagesertrag" />
		</on-entry>
		<transition on="submit" to="enterVerbrauch"></transition>
		<transition on="cancel" to="startEnterPVData"></transition>
	</view-state>
	
	<view-state id="enterVerbrauch" 
		view="/WEB-INF/flows/photovoltaik/startEnterVerbrauch.jsp" model="flowScope.tagesverbrauch">
		<on-entry>
			<evaluate expression="tagesverbrauch.setInitValues()" result="flowScope.tagesverbrauch" />
		</on-entry>
		<transition on="submit" to="reviewEnterPVData"></transition>
		<transition on="back" to="startEnterPVData" validate="false"></transition>
	</view-state>

	<view-state id="reviewEnterPVData" view="/WEB-INF/flows/photovoltaik/reviewEnterPVData.jsp">
		<transition on="submit" to="savePVData"></transition>
		<transition on="back" to="enterVerbrauch" validate="false"/>
	</view-state>
	<!-- 
	Da es hier zwei evaluate Expressions gibt und die erste ein Event (success|failure) zurück gibt,
	wird die zweite evaluate Expression nicht mehr ausgeführt
	 -->
	<action-state id="savePVData">
		<evaluate expression="dataAccessObjectImpl.addTagesverbrauch(tagesverbrauch)"></evaluate>
		<evaluate expression="dataAccessObjectImpl.addTagesertrag(tagesertrag)"></evaluate>
		<transition on-exception="de.app.utilities.DBException" to="enterPVDataFailure"/>
		<transition on="success" to="enterPVDataSuccess"/>
		<transition on="failure" to="enterPVDataFailure"/>
	</action-state>

	<end-state id="enterPVDataSuccess" view="/WEB-INF/flows/photovoltaik/enterPVDataSuccess.jsp"/>
	<end-state id="enterPVDataFailure" view="/WEB-INF/flows/photovoltaik/enterPVDataFailure.jsp"/>

</flow>